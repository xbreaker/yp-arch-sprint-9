# Задание 3. Открытие депозитов онлайн

### Функциональные требования
Опишите здесь верхнеуровневые Use Cases. Их нужно оформить в виде таблицы с пошаговым описанием:

| №   | Действующие лица / системы                                 | Use Case                            | Шаги / краткое описание                                                                                                                                                                                                                                                                                                                                                                                                                    |
|-----|------------------------------------------------------------|-------------------------------------|--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------|
| 1   | Гость сайта<br />Сайт</br>АБС                              | Отображение списка депозитов        | 1. Гость открывает сайт банка <br>2. Гость переходит в раздел депозитов<br>3. Сайт обращается к АБС за актуальными ставками и депозитами<br/>4. Сайт отображает депозиты с актуальными ставками                                                                                                                                                                                                                                            |
| 2   | Гость сайта<br />Интернет-банк</br>АБС                     | Отображение списка депозитов        | 1. Гость открывает интернет-банк <br>2. Гость переходит в раздел депозитов<br>3. Интернет-банк обращается к АБС за актуальными ставками и депозитами<br/>4. Интернет-банк отображает депозиты с актуальными ставками                                                                                                                                                                                                                       |
| 3   | Гость сайта<br />Сайт</br>Шина данных (Kafka)<br/>СМС шлюз | Заявка на депозит                   | 1. Гость выбирает депозит из списка депозитов <br>2. Гость заполняет форму заявки<br>3. Сайт обращается к СМС шлюзу для отправки СМС клиенту с подтверждением заявки<br />4. Клиент подтверждает заявку с помощью СМС <br/> 5. Сайт передает заявку в очередь Kafka и ждет обработки                                                                                                                                                       |
| 4   | Клиентский менеджер<br />АБС<br />Шина данных<br/>СМС шлюз | Обработка заявки на депозит (успех) | 1. Менеджер открывает список заявок на депозит в АБС <br>2. АБС запрашивает заявки из очереди Kafka<br />3. Менеджер выбирает заявку и связывается с клиентом <br>4. Клиент согласен на депозит - менеджер приглашает его в офис для оформления договора<br />5. Менеджер заводит в АБС предварительный договор и удаляет заявку из очереди на обработку<br />6. АБС отправляет СМС через СМС шлюз<br />7. Клиент получает СМС уведомление |
| 5   | Клиентский менеджер<br />АБС<br />Шина данных              | Обработка заявки на депозит (отказ) | 1. Менеджер открывает список заявок на депозит в АБС <br>2. АБС запрашивает заявки из очереди Kafka<br />3. Менеджер выбирает заявку и связывается с клиентом <br>4. Клиент отказывается от депозита<br />5. Менеджер удаляет заявку из очереди на обработку                                                                                                                                                                               |


### Нефункциональные требования
Опишите здесь нефункциональные требования и архитектурно-значимые требования.

| №   | Требование                                                            |
|-----|-----------------------------------------------------------------------|
| 1   | Высокая доступность систем (99,9%)                                    |
| 2   | Шифрование всех каналов TLS 1.3, хранение секретов в защищенном vault |
| 3   | Резервное копирование (С переключением на резервный ЦОД)              |
| 4   | Горизонтальная масштабируемость                                       |
| 5   | Возможность работы интернет-банка сразу из 2-х ЦОД                    |

### Решение
Выбор сделан в пользу архитектуры с использованием шины данных, так как мы ограничены текущими решениями и компетенциями сотрудников. Шина данных позволит исключить вспелски нагрузок на API АБС, а так же исключит потенциальную потерю заявок в случае недоступности АБС.
[Диаграмма контекста](c4_context.drawio)
[Диаграмма контейнеров](c4_container.drawio)

### <a name="_bjrr7veeh80c"></a>**Альтернативы**
Главной альтернативой является переход на микросервисную архитектуру и отказ от устаревшего стека.

**Недостатки, ограничения, риски**
Монолитное решение на APS.NET - трудно развивать, дорого поддерживать
АБС масштабируется только вертикально - лавинообразная нагрузка может создать эффект бутылочного горлышка
Необходимость работать с API АБС напрямую

